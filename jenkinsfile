pipeline {
  agent any
  node {
    env.NODEJS_HOME = "${tool 'NodeJsv12.16.2'}"
    env.PATH="${env.NODEJS_HOME}/bin:${env.PATH}"
  stages {

      stage('GIT PULL') {
        steps {
          script {
            sh 'cd /home/ubuntu/repos/web-server-teste && git pull'
          }
        }
      }

      stage('PM2 START') {
        steps {
          script {
            sh 'node -v'
          }
          script {
            sh 'cd /home/ubuntu/repos/web-server-teste && npm install'
          }
          script {
            sh 'node index.js'
          }

        }
      }

      stage('Deploy') {
        steps {
          echo 'Deploying...'
        }
      }
  }
  }

}